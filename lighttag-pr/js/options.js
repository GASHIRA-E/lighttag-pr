const b=document.getElementById("labelGroups"),h=document.getElementById("addGroupBtn"),g=document.getElementById("configJson"),f=document.getElementById("exportBtn"),v=document.getElementById("importBtn"),C=document.getElementById("saveBtn"),u=document.getElementById("statusMessage");let t={labels:[]};document.addEventListener("DOMContentLoaded",()=>{y(),h.addEventListener("click",L),f.addEventListener("click",N),v.addEventListener("click",k),C.addEventListener("click",G)});function y(){chrome.storage.local.get("labelsConfig",e=>{e.labelsConfig?t=e.labelsConfig:t={labels:[{type:"観点",items:[{label:"設計",description:"設計や仕様に合致しているか"},{label:"テスト",description:"テストが十分か"}]},{type:"温度感",items:[{label:"FYI",description:"参考情報の共有"},{label:"Q",description:"質問"}]}]},r()})}function r(){b.innerHTML="",t.labels.forEach((e,a)=>{const c=document.createElement("div");c.className="label-group",c.dataset.groupIndex=a.toString();const s=document.createElement("div");s.className="label-group-header";const n=document.createElement("input");n.type="text",n.value=e.type,n.placeholder="グループ名",n.addEventListener("change",d=>{const p=d.target;t.labels[a].type=p.value});const l=document.createElement("button");l.className="btn btn-danger btn-small",l.textContent="グループ削除",l.addEventListener("click",()=>{t.labels.splice(a,1),r()}),s.appendChild(n),s.appendChild(l),c.appendChild(s);const o=document.createElement("div");o.className="label-items",e.items.forEach((d,p)=>{const E=B(a,p,d);o.appendChild(E)}),c.appendChild(o);const i=document.createElement("button");i.className="btn",i.textContent="ラベル追加",i.addEventListener("click",()=>{t.labels[a].items.push({label:"",description:""}),r()}),c.appendChild(i),b.appendChild(c)})}function B(e,a,c){const s=document.createElement("div");s.className="label-item";const n=document.createElement("input");n.type="text",n.className="label-name",n.value=c.label,n.placeholder="ラベル名",n.addEventListener("change",i=>{const d=i.target;t.labels[e].items[a].label=d.value});const l=document.createElement("input");l.type="text",l.className="label-description",l.value=c.description,l.placeholder="説明",l.addEventListener("change",i=>{const d=i.target;t.labels[e].items[a].description=d.value});const o=document.createElement("button");return o.className="btn btn-danger btn-small",o.textContent="削除",o.addEventListener("click",()=>{t.labels[e].items.splice(a,1),r()}),s.appendChild(n),s.appendChild(l),s.appendChild(o),s}function L(){t.labels.push({type:"新しいグループ",items:[{label:"",description:""}]}),r()}function N(){g.value=JSON.stringify(t,null,2),m("設定をエクスポートしました","success")}function k(){try{const e=JSON.parse(g.value);if(!e.labels||!Array.isArray(e.labels))throw new Error("無効なフォーマットです。labelsプロパティが必要です。");t=e,r(),m("設定をインポートしました","success")}catch(e){e instanceof Error?m(`エラー: ${e.message}`,"error"):m("不明なエラーが発生しました","error")}}function G(){chrome.storage.local.set({labelsConfig:t},()=>{m("設定を保存しました","success")})}function m(e,a){u.textContent=e,u.className=`status-message ${a}`,setTimeout(()=>{u.className="status-message hidden"},3e3)}
